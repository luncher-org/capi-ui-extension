(("undefined"!==typeof self?self:this)["webpackJsonpcapi_0_1_0"]=("undefined"!==typeof self?self:this)["webpackJsonpcapi_0_1_0"]||[]).push([[1],{"1d8c":function(e,a,n){var t=n("26d9");t.__esModule&&(t=t.default),"string"===typeof t&&(t=[[e.i,t,""]]),t.locals&&(e.exports=t.locals);var i=n("0ed3").default;i("29394dee",t,!0,{sourceMap:!1,shadowMode:!1})},"26d9":function(e,a,n){var t=n("5eaa");a=t(!1),a.push([e.i,'.align-center[data-v-146b4579]{align-self:"center"}.input-label[data-v-146b4579]{color:var(--input-label);margin-bottom:5px;display:block;width:100%}.input-label .icon-warning[data-v-146b4579]{color:var(--error)}',""]),e.exports=a},"2ad0":function(e,a,n){"use strict";n("59ca")},"421c":function(e,a,n){var t=n("5eaa");a=t(!1),a.push([e.i,".variables[data-v-77f4863f]{display:flex;flex-direction:row;flex-wrap:wrap}.variables>*[data-v-77f4863f]{flex:0 1 23.25%;margin:0 1.75% 10px 0;max-width:23.25%}.variables[data-v-77f4863f]>.wider{flex:0 1 48.25%;max-width:48.25%}.variables>.force-newline[data-v-77f4863f]{flex:1 0 100%;max-width:none}",""]),e.exports=a},"59ca":function(e,a,n){var t=n("421c");t.__esModule&&(t=t.default),"string"===typeof t&&(t=[[e.i,t,""]]),t.locals&&(e.exports=t.locals);var i=n("0ed3").default;i("0f5c0388",t,!0,{sourceMap:!1,shadowMode:!1})},7267:function(e,a,n){"use strict";n("1d8c")},df7e:function(e,a,n){"use strict";n.r(a);var t=function(){var e=this,a=e._self._c;e._self._setupProxy;return a("div",[a("div",[e._v("Is valid: "+e._s(e.variablesValid))]),a("div",{staticClass:"row"},[a("div",{staticClass:"col span-6"},[e.clusterClasses?a("LabeledSelect",{attrs:{label:"cluster class",options:e.clusterClassOptions},model:{value:e.clusterClassId,callback:function(a){e.clusterClassId=a},expression:"clusterClassId"}}):e._e()],1)]),a("Tabbed",{attrs:{"side-tabs":!0}},[a("Tab",{attrs:{label:"Root Variables",name:"rootvariables"}},[e.clusterClass?a("CCVariables",{attrs:{"cluster-class":e.clusterClass},on:{"validation-passed":a=>e.variablesValid=a},model:{value:e.variables,callback:function(a){e.variables=a},expression:"variables"}}):e._e()],1),e.clusterClass?a("Tab",{attrs:{label:"Machine Deployment Variables",name:"mcvariables"}},[a("div",{staticClass:"row"},[a("div",{staticClass:"col span-6"},[a("LabeledSelect",{attrs:{label:"machine pool class",options:e.machineDeploymentOptions},model:{value:e.selectedMachineDeployment,callback:function(a){e.selectedMachineDeployment=a},expression:"selectedMachineDeployment"}})],1),a("div",{staticClass:"col span-6"},[a("button",{staticClass:"btn-sm role-secondary",attrs:{type:"button",label:"machine deployment name"},on:{click:e.addDeployment}},[e._v(" add ")])])]),e._l(e.value.spec.topology.workers.machineDeployments,(function(n,t){return[a("hr",{key:`${n.class}-${t}-hr`}),a("div",{key:`${n.class}-${t}`,staticClass:"row mt-10"},[a("div",{staticClass:"col span-6"},[a("LabeledInput",{attrs:{label:"machine deployment name"},model:{value:n.name,callback:function(a){e.$set(n,"name",a)},expression:"md.name"}})],1)]),a("h3",{key:`${n.class}-${t}-title`,staticClass:"mt-20"},[e._v(" "+e._s(n.class)+" Variable Overrides ")]),e.clusterClass?a("CCVariables",{key:`${n.class}-${t}-vars`,attrs:{"machine-deployment-class":n.class,"cluster-class":e.clusterClass},on:{"validation-passed":a=>e.variablesValid=a},model:{value:n.variables.overrides,callback:function(a){e.$set(n.variables,"overrides",a)},expression:"md.variables.overrides"}}):e._e()]}))],2):e._e()],1)],1)},i=[],s=n("0f9e"),l=n("8bbf"),r=n("0cb2"),o=n("38de"),u=n("466b"),c=n("e26b"),d=n("7e89"),v=function(){var e=this,a=e._self._c;e._self._setupProxy;return a("div",{staticClass:"variables"},[e.variableDefinitions&&e.variableDefinitions.length?[e._l(e.variableDefinitions,(function(n,t){return[a("Variable",{key:""+n.name,ref:n.name+"-input",refInFor:!0,attrs:{variable:n,value:e.valueFor(n),"validate-required":!e.machineDeploymentClass&&!e.machinePoolClass},on:{input:a=>e.updateVariables(a,n),"validation-passed":e.updateErrors}}),e.newComponentType(n,t)?a("div",{key:`${t}-${e.rerenderKey}`,staticClass:"force-newline"}):e._e()]}))]:e._e()],2)},m=[],p=n("44db"),f=n.n(p),h=n("2cb5"),b=n("330a"),y=n.n(b),C=n("c4c6"),x=n("760b"),k=function(e,a,n){var t=a.key,i=void 0===t?"Value":t,s=n.exclusiveMinimum,l=n.exclusiveMaximum,r=n.maxItems,o=n.maxLength,u=n.maximum,c=n.minItems,d=n.minLength,v=n.minimum,m=n.pattern,p=n.uniqueItems,f=n.required,h=n.format,b=[];return u&&(l?b.push((function(a){return Number(a)>=Number(u)?e("validation.exclusiveMaxValue",{key:i,maximum:u}):void 0})):b.push((function(a){return Number(a)>Number(u)?e("validation.maxValue",{key:i,max:u}):void 0}))),void 0!==v&&(s?b.push((function(a){return Number(a)<=Number(v)?e("validation.exclusiveMinValue",{key:i,minimum:v}):void 0})):b.push((function(a){return Number(a)<Number(v)?e("validation.minValue",{key:i,min:v}):void 0}))),void 0!==d&&b.push((function(a){return a&&a.length<Number(d)?e("validation.minLength",{key:i,min:d}):void 0})),o&&b.push((function(a){return a&&a.length>Number(o)?e("validation.maxLength",{key:i,max:o}):void 0})),r&&b.push((function(a){return a&&a.length>r?e("validation.maxItems",{key:i,maxItems:r}):void 0})),void 0!==c&&b.push((function(a){return a&&a.length<c?e("validation.minItems",{key:i,minItems:c}):void 0})),m&&b.push(_(e("validation.pattern",{key:i,pattern:m}),new RegExp(m))),h&&g(e,{key:i},h)&&b.push(g(e,{key:i},h)),p&&b.push((function(a){return a&&a.filter((function(e,n){return a.indexOf(e)!==n})).length?e("validation.uniqueItems",{key:i}):void 0})),f&&b.push((function(a){return f.find((function(e){return void 0===a[e]}))?e("validation.requiredFields",{key:i,requiredFields:f.toString()}):void 0})),b},_=function(e,a){return function(n){return n&&!n.match(a)?e:void 0}},g=function(e,a,n){var t=a.key,i=void 0===t?"Value":t,s=Object(x["a"])(e,{key:i}),l=e("validation.stringFormat",{key:i,format:n});switch(n){case"hostname":return function(e){return s.wildcardHostname(e)};case"ipv4":return function(e){return e&&!Object(h["i"])(e)?l:void 0};case"cidr":return function(e){return e&&!Object(C["a"])(e)?l:void 0};case"mac":return function(e){return e&&!Object(C["b"])(e)?l:void 0};case"uuid":return _(l,/^[0-9a-f]{8}-?[0-9a-f]{4}-?[0-9a-f]{4}-?[0-9a-f]{4}-?[0-9a-f]{12}$/i);case"uuid3":return _(l,/^[0-9a-f]{8}-?[0-9a-f]{4}-?3[0-9a-f]{3}-?[0-9a-f]{4}-?[0-9a-f]{12}$/i);case"uuid4":return _(l,/^[0-9a-f]{8}-?[0-9a-f]{4}-?4[0-9a-f]{3}-?[89ab][0-9a-f]{3}-?[0-9a-f]{12}$/i);case"uuid5":return _(l,/^[0-9a-f]{8}-?[0-9a-f]{4}-?5[0-9a-f]{3}-?[89ab][0-9a-f]{3}-?[0-9a-f]{12}$/i);default:return}},w=function(e){return e||!1===e||!y()(e)},V=function(){var e,a=this,n=a._self._c;a._self._setupProxy;return a.componentForType?n("div",{class:{wider:a.listComponent,"align-center":"checkbox-var"===(null===(e=a.componentForType)||void 0===e?void 0:e.name),[""+a.componentForType.name]:!0}},[a.componentForType?n(a.componentForType.component,{tag:"component",attrs:{value:a.value,label:a.variable.name,placeholder:a.schema.example,tooltip:a.schema.description,required:a.variable.required&&a.validateRequired,title:a.variable.name,options:a.variableOptions,rules:a.listComponent?[]:a.validationRules,type:"number"===a.schema.type||"integer"===a.schema.type?"number":"text"},on:{input:a.setValue},scopedSlots:a._u([{key:"title",fn:function(){return[n("div",{staticClass:"input-label"},[n("span",[a._v(a._s(a.variable.name)+" "),a.schema.description?n("i",{directives:[{name:"clean-tooltip",rawName:"v-clean-tooltip",value:a.schema.description,expression:"schema.description"}],staticClass:"icon icon-sm icon-info"}):a._e(),a.isValid?a._e():n("i",{directives:[{name:"clean-tooltip",rawName:"v-clean-tooltip",value:a.validationErrors.join(" "),expression:"validationErrors.join(' ')"}],staticClass:"icon icon-warning"})])])]},proxy:!0}],null,!1,149827440)}):a._e(),n("div",{staticClass:"flexbox-newline"})],1):a._e()},O=[],D=n("1032"),j=n("a232"),$=n("977f"),I=n("9ce4"),S=Object(l["defineComponent"])({name:"CCVariable",props:{variable:{type:Object,required:!0},value:{type:[String,Object,Boolean,Array,Number],default:function(){return null}},validateRequired:{type:Boolean,default:!0}},watch:{isValid:function(e){this.$emit("validation-passed",e)}},created:function(){this.isValid||this.$emit("validation-passed",!1)},computed:Object(s["a"])(Object(s["a"])({},Object(I["a"])({t:"i18n/t"})),{componentForType:function(){var e,a=this.schema.type;if(this.variableOptions)e={component:u["a"],name:"text-var"};else switch(a){case"object":e={component:j["a"],name:"keyvalue-var"};break;case"array":e={component:$["a"],name:"arraylist-var"};break;case"string":e={component:c["a"],name:"text-var"};break;case"integer":e={component:c["a"],name:"text-var"};break;case"number":e={component:c["a"],name:"text-var"};break;case"boolean":e={component:D["a"],name:"checkbox-var"};break;default:break}return e},schema:function(){var e,a;return null===(a=null===(e=this.variable)||void 0===e?void 0:e.schema)||void 0===a?void 0:a.openAPIV3Schema},variableOptions:function(){var e,a=null===(e=this.schema)||void 0===e?void 0:e.enum;return a&&a.length?a.map((function(e){return"object"===typeof e?JSON.stringify(e):e})):null},validationRules:function(){var e,a=this,n=this.t,t=k(n,{key:this.variable.name},this.schema),i=null===(e=this.variable)||void 0===e?void 0:e.required;return i&&this.validateRequired&&t.push((function(e){return w(e)?void 0:n("validation.required",{key:a.variable.name})})),t},isValid:function(){return!this.validationErrors.length},validationErrors:function(){var e=this;return this.validationRules.reduce((function(a,n){var t=n(e.value);return t&&a.push(t),a}),[])},listComponent:function(){var e,a;return"arraylist-var"===(null===(e=this.componentForType)||void 0===e?void 0:e.name)||"keyvalue-var"===(null===(a=this.componentForType)||void 0===a?void 0:a.name)}}),methods:{setValue:function(e){var a=e,n=this.schema.type;if("object"===n)try{a=JSON.parse(e)}catch(t){}this.$emit("input",a)}}}),P=S,T=(n("7267"),n("d802")),M=Object(T["a"])(P,V,O,!1,null,"146b4579",null),F=M.exports,N=Object(l["defineComponent"])({name:"ClusterClassVariables",components:{Variable:F},props:{clusterClass:{type:Object,default:function(){}},value:{type:Array,default:function(){return[]}},machineDeploymentClass:{type:String,default:null},machinePoolClass:{type:String,default:null}},data:function(){return{errorCount:0,rerenderKey:Object(h["n"])()}},watch:{errorCount:{handler:f()((function(e){this.$emit("validation-passed",!e)}),5)},variableDefinitions:function(e,a){var n=this;this.updateVariableDefaults(e,a),this.$nextTick((function(){n.rerenderKey=Object(h["n"])()}))}},created:function(){this.updateVariableDefaults(this.variableDefinitions,[])},computed:{variableDefinitions:function(){var e,a,n=(null===(a=null===(e=this.clusterClass)||void 0===e?void 0:e.spec)||void 0===a?void 0:a.variables)||[];if(!this.machineDeploymentClass&&!this.machinePoolClass)return n;var t=this.machineScopedJsonPatches.reduce((function(e,a){var n,t=null===(n=null===a||void 0===a?void 0:a.valueFrom)||void 0===n?void 0:n.variable;if(!t)return e;var i=t.split(/\.|\[/)[0];return"builtin"!==i&&e.push(i),e}),[]);return n.filter((function(e){return t.includes(e.name)}))},machineScopedJsonPatches:function(){var e,a;if(!this.machineDeploymentClass&&!this.machinePoolClass)return[];var n=[],t=this.machineDeploymentClass||this.machinePoolClass,i=this.machineDeploymentClass?"machineDeploymentClass":"machinePoolClass",s=(null===(a=null===(e=this.clusterClass)||void 0===e?void 0:e.spec)||void 0===a?void 0:a.patches)||[];return s.forEach((function(e){var a=(null===e||void 0===e?void 0:e.definitions)||[];a.forEach((function(e){var a,s,l,r=(null===(l=null===(s=null===(a=null===e||void 0===e?void 0:e.selector)||void 0===a?void 0:a.matchResources)||void 0===s?void 0:s[i])||void 0===l?void 0:l.names)||[];r.includes(t)&&n.push.apply(n,e.jsonPatches)}))})),n}},methods:{valueFor:function(e){return(this.value.find((function(a){return a.name===e.name}))||{}).value},updateVariables:function(e,a){var n=Object(s["d"])(this.value),t=this.value.findIndex((function(e){return e.name===a.name}));t>=0?n[t].value=e:n.push({value:e,name:a.name}),this.$emit("input",n)},updateVariableDefaults:function(e,a){var n=Object(s["d"])(this.value).reduce((function(n,t){var i,s,l,r,o,u,c,d=(e||[]).find((function(e){return e.name===t.name}));if(!d)return n;var v=null===(l=null===(s=null===(i=(a||[]).find((function(e){return e.name===t.name})))||void 0===i?void 0:i.schema)||void 0===s?void 0:s.openAPIV3Schema)||void 0===l?void 0:l.default;w(v)&&t.value===v&&delete t.value;var m=null===(o=null===(r=d.schema)||void 0===r?void 0:r.openAPIV3Schema)||void 0===o?void 0:o.default;return"boolean"!==(null===(c=null===(u=d.schema)||void 0===u?void 0:u.openAPIV3Schema)||void 0===c?void 0:c.type)||m||(m=!1),w(m)&&!t.value&&(t.value=m),n.push(t),n}),[]);e.forEach((function(e){var a,t,i,s,l=null===(t=null===(a=e.schema)||void 0===a?void 0:a.openAPIV3Schema)||void 0===t?void 0:t.default;"boolean"!==(null===(s=null===(i=e.schema)||void 0===i?void 0:i.openAPIV3Schema)||void 0===s?void 0:s.type)||l||(l=!1),w(l)&&!n.find((function(a){return a.name===e.name}))&&n.push({name:e.name,value:l})})),this.errorCount=0,this.$emit("input",n)},updateErrors:function(e){e?this.errorCount--:this.errorCount++},newComponentType:function(e,a){var n,t,i,s,l,r=this.$refs,o=null===(t=null===(n=r[e.name+"-input"])||void 0===n?void 0:n[0])||void 0===t?void 0:t.$el,u=null===(l=null===(s=r[(null===(i=this.variableDefinitions[a+1])||void 0===i?void 0:i.name)+"-input"])||void 0===s?void 0:s[0])||void 0===l?void 0:l.$el;return!!u&&(null===o||void 0===o?void 0:o._prevClass)!==u._prevClass}}}),q=N,E=(n("2ad0"),Object(T["a"])(q,v,m,!1,null,"77f4863f",null)),L=E.exports,A=Object(l["defineComponent"])({name:"EditCapiCluster",components:{CCVariables:L,Tabbed:r["a"],Tab:o["a"],LabeledSelect:u["a"],LabeledInput:c["a"]},props:{value:{type:Object,default:function(){return{}}}},fetch:function(){return Object(s["b"])(this,void 0,void 0,(function(){var e;return Object(s["c"])(this,(function(a){switch(a.label){case 0:return this.$set(this.value,"spec",{topology:{variables:[],workers:{machineDeployments:[],machinePools:[]}}}),e=this,[4,this.$store.dispatch("management/findAll",{type:d["a"].CLUSTER_CLASS})];case 1:return e.clusterClasses=a.sent(),[2]}}))}))},data:function(){return{clusterClassId:null,clusterClasses:[],variables:[],variablesValid:!0,selectedMachineDeployment:""}},computed:{clusterClassOptions:function(){return(this.clusterClasses||[]).map((function(e){return{label:e.metadata.name,value:e.id}}))},clusterClass:function(){var e=this;return this.clusterClassId&&this.clusterClasses?this.clusterClasses.find((function(a){return a.id===e.clusterClassId})):null},machineDeploymentOptions:function(){var e,a,n;return((null===(n=null===(a=null===(e=this.clusterClass)||void 0===e?void 0:e.spec)||void 0===a?void 0:a.workers)||void 0===n?void 0:n.machineDeployments)||[]).map((function(e){return e.class}))}},methods:{addDeployment:function(){var e=(this.value.spec.topology.workers.machineDeployments||[]).length;this.value.spec.topology.workers.machineDeployments.push({class:this.selectedMachineDeployment,name:"machine-"+e,variables:{overrides:[]}})}}}),R=A,J=Object(T["a"])(R,t,i,!1,null,null,null);a["default"]=J.exports}}]);
//# sourceMappingURL=capi-0.1.0.umd.min.edit.js.map